<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Server-side Webscripting &mdash; 03.forms</title>

		<meta name="description" content="Webscripting1 &mdash; Server-side Webscripting &mdash; 03.forms">
		<meta name="author" content="Bram(us) Van Damme - ikdoeict.be">

		<link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">

		<style>
			.columns .column {
				float: left;
				list-style: none;
				margin: 0 0 12px 0;
				padding: 0;
			}

			.column-12 {
				width: 50%;
			}
			code {
				color: gainsboro;
			}

			li > code, li em > code, li del > code, li ins > code, p > code {
				background: #3F3F3F;
				padding: 2px 4px;
				box-shadow: 0px 0px 6px rgba(0,0,0,0.3);
				font-size: 80%;
			}

			del code, code.nok {
				color: #C55;
			}

			ins code, code.ok {
				color: #5C5;
			}

			strong {
				color: #553d00;
				background: transparent url('assets/02/strong.png') no-repeat 50% 50%;
				font-size: 80%;
				padding: 0 4px;
				font-family: palatino, times;
				font-weight: 300;
				font-style: italic;
			}

			figure.zoomable-12:hover {
				-moz-transform: scale(1.2);
				-o-transform: scale(1.2);
				-webkit-transform: scale(1.2);
				transform: scale(1.2);
			}

			figure.zoomable-15:hover {
				-moz-transform: scale(1.5);
				-o-transform: scale(1.5);
				-webkit-transform: scale(1.5);
				transform: scale(1.5);
			}

			figure.zoomable-20:hover {
				-moz-transform: scale(2);
				-o-transform: scale(2);
				-webkit-transform: scale(2);
				transform: scale(2);
			}

			#reveal section ul + p > img {
				margin-top: 0;
			}

			#reveal section img.noborder {
				background: transparent;
				border: 0;
				-webkit-box-shadow: none;
				-moz-box-shadow: none;
				-ms-box-shadow: none;
				-o-box-shadow: none;
				box-shadow: none;"
			}

			#reveal section img.noborder + figcaption {
				margin-top: -40px;
				text-align: center;
			}

			#reveal section .zoomable-20 img.noborder + figcaption {
				margin-top: -20px;
			}

			table {
				font-size: 15px;
				border-collapse: collapse;
				width: 100%;
			}

			table td, table th {
				line-height: 1.4;
				border: 1px solid #ccc;
				padding: 4px;
			}

			table th {
				background: #333;
			}

			html, body {
				background: #34afbd;
				background: radial-gradient(ellipse at center, #34afbd 0%,#1c1e20 100%);
				letter-spacing: 0em;
			}

			#reveal nav {
				opacity: 0.3;
				letter-spacing: -0.02em;
			}
		</style>
	</head>

	<body>

		<div id="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- 0 : Title -->
				<section>

					<section>
						<h3 class="inverted">Server-side Webscripting</h3>
						<h1>03.forms</h1>

						<footer>
							<em>Course materials: <a href="http://www.bram.us/">Bram(us) Van Damme</a> &mdash; Lecturer: <a href="mailto:joris.maervoet@odisee.be">Joris Maervoet</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>

				</section>


				<!-- form basics -->
				<section>

					<section>
						<h2>Form Basics</h2>
					</section>

					<section>
						<h2>Example form</h2>
						<div class="fragment">
							<figure>
								<a href="assets/03/examples/form_01.php"><img src="assets/03/testform.jpg" alt="Our testform" title="Our testform" width="700" /></a>
							</figure>
							<p style="font-size: 75%">Let's take a look at <code>assets/03/examples/form_01.php</code> <a href="assets/03/examples/form_01.php">&rarr;</a></p>

						</div>
					</section>

					<section>
						<h2>A proper HTML Form (1)</h2>
						<ul>
							<li class="fragment">
								If your form is built properly, it's easy to work with forms in PHP
							</li>
							<li class="fragment">
								Important HTML <code>&lt;form&gt;</code> attributes
								<ul>
									<li>
										<code>method</code> &mdash; HTTP method to use; <code>get</code> or <code>post</code> (default: <code>get</code>)
									</li>
									<li>
										<code>action</code> &mdash; Where to send the form-data to when submitted
									</li>
									<li>
										<code>enctype</code> &mdash; How the form-data should be encoded when using <code>post</code>
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>A proper HTML Form (2)</h2>
						<ul>
							<li class="fragment">
								Always give <code>&lt;input&gt;</code> and <code>&lt;textarea&gt;</code> elements a <code>name</code>
								<ul>
									<li>Radiobuttons: same <code>name</code> in same set</li>
									<li>Checkboxes: same <code>name</code> with square brackets in same set</li>
								</ul>
							</li>
							<li class="fragment">
								Always give	<code>&lt;select&gt;</code> elements a <code>name</code>
								<ul>
									<li>Specify a <code>value</code> for each <code>&lt;option&gt;</code> of the <code>&lt;select&gt;</code></li>
								</ul>
							</li>
							<li class="fragment">
								<code>id</code> attributes not mandatory for proper functioning
								<ul>
									<li>Webbrowsers &amp; servers use the <code>name</code> attributes</li>
									<li>Only to be added for JS purposes</li>
									<li>Remember an <code>id</code> must be unique</li>
								</ul>
							</li>
						</ul>
					</section>

				</section>



				<!-- Handling Forms: Querystring, GET vs. POST -->
				<section>

					<section>
						<h2>Querystring</h2>
					</section>

					<section>
						<h2>Querystring?</h2>
						<ul>
							<li class="fragment">
								Upon submitting your form, the browser will collect all (*) form-data in one text string named the <strong>querystring</strong>
								<ul>
									<li><em>(*) Not all really, more on that later</em></li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Querystring format: <code>key=value&amp;key=value&amp;key=value</code>
								<ul>
									<li>The <code>key</code>s are the <code>name</code> attributes of the elements, the <code>value</code>s the entered/selected <code>value</code>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								The browser then makes a request to the URL defined in the form <code>action</code> attribute and pass that querystring to it
							</li>
						</ul>
					</section>

					<section>
						<h2>GET vs POST (1)</h2>
						<ul>
							<li class="fragment">
								With <code>GET</code> all values of the querystring are attached to the form its <code>target</code> URL
								<ul>
									<li>The entered values are visible in the URL of the browser</li>
									<li>
										In order to prevent conflicts the values are URL encoded before being attached
										<ul>
											<li>Think <code>&amp;</code> and <code>=</code> that could break the format of the querystring</li>
										</ul>
									</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								With <code>POST</code> the querystring is sent in the <em>request body</em>
								<ul>
									<li>
										The entered values are not visible in the URL of the browser, only via sniffing
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>GET vs POST (2)</h2>
						<div style="text-align: center;">
							<figure class="zoomable-15 fragment">
								<img src="assets/03/request-get.jpg" alt="Charles output of a form sent via GET" title="Charles output of a form sent via GET" width="650" />
								<figcaption>Charles output of a form sent via GET</figcaption>
							</figure>
							<figure class="zoomable-15 fragment">
								<img src="assets/03/request-post.jpg" alt="Charles output of a form sent via POST" title="Charles output of a form sent via POST" width="650" />
								<figcaption>Charles output of a form sent via POST</figcaption>
							</figure>
						</div>
					</section>


					<section>
						<h2>URL Encoding <small style="background-color: #f00;border-radius: 10px;">FYI</small></h2>
						<ul>
							<li class="fragment">
								A few frequently used characters
								<table>
									<thead>
										<tr>
											<th>Character</th>
											<th>URL Encoded</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>$</td>
											<td>%24</td>
										</tr>
										<tr>
											<td>&amp;</td>
											<td>%26</td>
										</tr>
										<tr>
											<td>&lt;</td>
											<td>%3C</td>
										</tr>
										<tr>
											<td>&gt;</td>
											<td>%3E</td>
										</tr>
										<tr>
											<td>?</td>
											<td>%3F</td>
										</tr>
										<tr>
											<td>;</td>
											<td>%3B</td>
										</tr>
										<tr>
											<td>#</td>
											<td>%23</td>
										</tr>
										<tr>
											<td>/</td>
											<td>%3A</td>
										</tr>
										<tr>
											<td>=</td>
											<td>%3D</td>
										</tr>
										<tr>
											<td>,</td>
											<td>%2C</td>
										</tr>
										<tr>
											<td>&quot;</td>
											<td>%22</td>
										</tr>
										<tr>
											<td>'</td>
											<td>%27</td>
										</tr>
										<tr>
											<td>+</td>
											<td>%2B</td>
										</tr>
										<tr>
											<td>%</td>
											<td>%25</td>
										</tr>
									</tbody>
								</table>
							</li>
						</ul>
					</section>

					<section>
						<h2>After sending</h2>
						<ul>
							<li class="fragment">
								After sending, PHP will decode the querystring and fill some associative arrays with the sent-in values for the receiving PHP script
								<ul>
									<li class="fragment"><code>$_GET</code> &mdash; All values sent via <code>GET</code></li>
									<li class="fragment"><code>$_POST</code> &mdash; All values sent via <code>POST</code></li>
									<li class="fragment">
										<code>$_REQUEST</code> &mdash; All values sent via <code>GET</code> and <code>POST</code>
										<ul>
											<li>Deprecated, don't ever use this!</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment">These arrays are also known as <a href="http://php.net/manual/en/language.variables.superglobals.php">Superglobals</a></footer>
					</section>

					<section>
						<h2>$_GET / $_POST Example</h2>
						<div class="fragment">
							<figure>
								<a href="assets/03/examples/form_01.php"><img src="assets/03/testform.jpg" alt="Our testform" title="Our testform" width="700" /></a>
							</figure>
							<p style="font-size: 75%">Let's take a look at <code>assets/03/examples/form_01.php</code> and <code>assets/03/examples/form_process.php</code> <a href="assets/03/examples/form_01.php">&rarr;</a></p>

						</div>
					</section>

					<section>
						<h2>Querystring revisited</h2>
						<ul>
							<li class="fragment">
								Upon submitting, all form fields are included in the <em>querystring</em>, except:
								<ul>
									<li class="fragment">Controls without a name attribute (<a href="assets/03/examples/form_02.php">demo</a>)</li>
									<li class="fragment">Unchecked radiobuttons (<a href="assets/03/examples/form_03.php">demo</a>)</li>
									<li class="fragment">Disabled controls (<a href="assets/03/examples/form_04.php">demo</a>)</li>
									<li class="fragment">Buttons that were not clicked (<a href="assets/03/examples/form_04.php">demo</a>)</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Summarized example: our testform</h2>
						<div class="fragment">
							<figure>
								<a href="assets/03/examples/form_05.php"><img src="assets/03/testform.jpg" alt="Our testform" title="Our testform" width="700" /></a>
							</figure>
						</div>
					</section>

					<section>
						<h2>Sidenote: combining GET and POST</h2>
						<ul>
							<li class="fragment">
								Possible if you already have parameters added onto the <code>target</code> URL
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/get_and_post.php">&lt;form action=&quot;form_process.php?foo=getfoo&amp;amp;bar=getbar&quot; method=&quot;post&quot;&gt;

	&lt;fieldset&gt;
		&lt;h2&gt;Get and Post&lt;/h2&gt;
		&lt;dl class=&quot;clearfix&quot;&gt;
			&lt;dt&gt;&lt;label for=&quot;foo&quot;&gt;Foo?&lt;/label&gt;&lt;/dt&gt;
			&lt;dd class=&quot;text&quot;&gt;
				&lt;input type=&quot;text&quot; id=&quot;foo&quot; name=&quot;foo&quot; value=&quot;&quot; /&gt;
			&lt;/dd&gt;

			&lt;dt&gt;&lt;label for=&quot;baz&quot;&gt;Baz?&lt;/label&gt;&lt;/dt&gt;
			&lt;dd class=&quot;text&quot;&gt;
				&lt;input type=&quot;text&quot; id=&quot;baz&quot; name=&quot;baz&quot; value=&quot;&quot; /&gt;
			&lt;/dd&gt;

			&lt;dt class=&quot;full clearfix&quot; id=&quot;lastrow&quot;&gt;
				&lt;input type=&quot;submit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;
			&lt;/dt&gt;
		&lt;/dl&gt;
	&lt;/fieldset&gt;
&lt;/form&gt;</code></pre></div>
							</li>
						</ul>
					</section>

					<section>
						<h2>When to use GET or POST (1)</h2>
						<ul>
							<li class="fragment">
								Use <code>GET</code> for read actions
								<ul>
									<li class="fragment"><code>showArticle()</code></li>
									<li class="fragment"><code>showComments()</code></li>
									<li class="fragment"><code>getSearchResults()</code></li>
								</ul>
							</li>
							<li class="fragment">
								Use <code>POST</code> for manipulative* and sensitive actions
								<ul>
									<li class="fragment"><code>addComment()</code></li>
									<li class="fragment"><code>deleteUser()</code></li>
									<li class="fragment"><code>login()</code></li>
								</ul>
							</li>
							<li class="fragment">
								Use <code>POST</code> when sending files
							</li>
							<li class="fragment">
								Use <code>POST</code> for lengthy data <em>(Max length URLs: 2048 chars)</em>
							</li>
						</ul>
						<footer class="fragment"><em>* actions that change data or that change the user's state</em></footer>
					</section>

					<section>
						<h2>When to use GET or POST (2)</h2>
						<ul>
							<li class="fragment">
								Examples of how it's not done:
								<ul>
									<li class="fragment">
										Consider these links
										<ul>
											<li><code>index.php?module=blog&amp;action=delete&amp;id=1</code></li>
											<li><code>login.php?username=bramus&amp;password=Azerty123</code></li>
											<li><code>like.php?page=HotBabes123</code></li>
										</ul>
									</li>
									<li class="fragment">
										Why not <code>GET</code>?
										<ul>
											<li class="fragment"><code>GET</code> can be bookmarked</li>
											<li class="fragment"><code>GET</code> can be distributed/embedded (iframe)</li>
											<li class="fragment"><code>GET</code> can be cached by webspiders</li>
											<li class="fragment"><code>GET</code> remains visible in the browser history</li>
											<li class="fragment"><code>GET</code> link can be prefetched by the browser</li>
										</ul>
									</li>
									<li class="fragment">
										&rarr; Use <code>POST</code> instead!
									</li>
								</ul>
							</li>
						</ul>
					</section>

				</section>


				<!-- Processing forms -->
				<section>

					<section>
						<h2>PHP Form Processing</h2>
					</section>

					<section>
						<h2>Sending forms</h2>
						<ul>
							<li class="fragment">
								The <code>action</code> attribute defines where to send a form to
							</li>
							<li class="fragment" style="margin-top: 1em;">
								In PHP we'll opt to send a form to itself
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Instead of typing the name of the file in manually, you can let PHP automatically output the URL of the page itself into the <code>action</code> attribute's value
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_01.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	...
&lt;/form&gt;</code></pre></div>
							</li>
						</ul>
						<footer class="fragment"><em>&rarr; This way we can put a file anywhere on the server, it will always submit to itself</em></footer>
					</section>

					<section>
						<h2>Default code structure</h2>
						<ul>
							<li class="fragment">
								A PHP page typically consists of two parts:
								<ol>
									<li>PHP Logic at the top</li>
									<li>HTML <em>(with a little PHP in between)</em> at the bottom</li>
								</ol>
							</li>
							<li class="fragment" style="margin-top: 1em">
								In the first part we'll:
								<ul>
									<li class="fragment">
										Get all values from <code>$_GET</code> or <code>$_POST</code>
									</li>
									<li class="fragment">
										Process the form (if it was submitted)
									</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em">
								In the second part we'll:
								<ul>
									<li class="fragment">
										Put our HTML
									</li>
									<li class="fragment">
										Use PHP to persist the values entered (if it was submitted)
									</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em>The line separating the two can be recognized by <code>?&gt;&lt;!DOCTYPE html&gt;</code></em></footer>
					</section>
				</section>



				<!-- Persistency -->
				<section>

					<section>
						<h2>Persisting form values</h2>
					</section>

					<section>
						<h2>Persistency</h2>

						<ul>
							<li class="fragment">
								= After having submitted the form to itself, make it show again the values you entered.
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Different types of inputs (text, checkbox, dropdown) require different persistency methods
							</li>
						</ul>
					</section>

					<section>
						<h2>Persisting text inputs</h2>
						<ul>
							<li class="fragment">
								<code>&lt;input type=&quot;text|password&quot;&gt;</code> and <code>&lt;textarea&gt;</code>
								<ul>
									<li class="fragment">Just output the sent-in value</li>
								</ul>
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_02.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

	// Get variable values from $_GET
	$name = $_GET['name'];
	$pass = $_GET['pass'];
	$remark = $_GET['remark'];

?&gt;&lt;DOCTYPE html&gt;

...

&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;

	&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot;
		value=&quot;&lt;?php echo $name; ?&gt;&quot; /&gt;

	&lt;input type=&quot;password&quot; id=&quot;pass&quot; name=&quot;pass&quot;
			value=&quot;&lt;?php echo $pass; ?&gt;&quot; /&gt;

	&lt;textarea name=&quot;remark&quot; id=&quot;remark&quot; rows=&quot;5&quot;
		cols=&quot;40&quot;&gt;&lt;?php echo $remark; ?&gt;&lt;/textarea&gt;

&lt;/form&gt;</code></pre></div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Persisting dropdowns</h2>
						<ul>
							<li class="fragment">
								<code>&lt;select&gt;</code>
								<ul>
									<li class="fragment">For each <code>&lt;option&gt;</code>, check if the value matches the sent-in value</em></li>
									<li class="fragment">If so: set the <code>selected=&quot;selected&quot;</code> attribute</li>
								</ul>
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_03.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

	// Get variable values from $_GET
	$cont = (int) $_GET['cont'];

?&gt;&lt;DOCTYPE html&gt;

...

&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	&lt;select name=&quot;cont&quot; id=&quot;cont&quot;&gt;
		&lt;option value=&quot;0&quot;&lt;?php if ($cont == 0) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Please select...&lt;/option&gt;
		&lt;option value=&quot;1&quot;&lt;?php if ($cont == 1) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Africa&lt;/option&gt;
		&lt;option value=&quot;2&quot;&lt;?php if ($cont == 2) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;America&lt;/option&gt;
		&lt;option value=&quot;3&quot;&lt;?php if ($cont == 3) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Antarctica&lt;/option&gt;
		&lt;option value=&quot;4&quot;&lt;?php if ($cont == 4) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Asia&lt;/option&gt;
		&lt;option value=&quot;5&quot;&lt;?php if ($cont == 5) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Europe&lt;/option&gt;
		&lt;option value=&quot;6&quot;&lt;?php if ($cont == 6) { echo ' selected=&quot;selected&quot;'; } ?&gt;&gt;Oceania&lt;/option&gt;
	&lt;/select&gt;
&lt;/form&gt;</code></pre></div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Persisting radiobtns &amp; checkboxes</h2>
						<ul>
							<li class="fragment">
								<code>&lt;input type=&quot;radio|checkbox&quot;&gt;</code>
								<ul>
									<li class="fragment">For each radiobutton, check if the value matches the sent-in value</li>
									<li class="fragment">If so: set the <code>checked=&quot;checked&quot;</code> attribute</li>
								</ul>
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_04.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

	// Get variable values from $_GET
	$gender = $_GET['gender'];
	$meals = $_GET['meals'];

?&gt;&lt;DOCTYPE html&gt;

...

&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;

	&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;male&quot;&lt;?php if ($gender
		 == 'male') { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;
	&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;female&quot;&lt;?php if ($gender
		 == 'female') { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;

	&lt;input type=&quot;checkbox&quot; name=&quot;meals[]&quot; value=&quot;breakfast&quot;&lt;?php if (in_array(
		'breakfast', $meals)) { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;
	&lt;input type=&quot;checkbox&quot; name=&quot;meals[]&quot; value=&quot;lunch&quot;&lt;?php if (in_array(
		'lunch', $meals)) { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;
	&lt;input type=&quot;checkbox&quot; name=&quot;meals[]&quot; value=&quot;dinner&quot;&lt;?php if (in_array(
		'dinner', $meals)) { echo ' checked=&quot;checked&quot;'; } ?&gt; /&gt;

&lt;/form&gt;</code></pre></div>
							</li>
						</ul>
					</section>


					<section>
						<h2>That's it?</h2>

						<ul>
							<li class="fragment">
								Not really, as we've been cheating in the code examples by suppressing errors
							</li>
							<li class="fragment">
								In reality we still have 2 issues to fix
								<ul>
									<li class="fragment">Undefined Index</li>
									<li class="fragment">XSS / <code>htmlentities()</code></li>
								</ul>
							</li>
					</section>

					<section>
						<h2>Issue #1: Undefined Index (1)</h2>
						<ul>
							<li class="fragment">
								When not suppressing errors, with exactly the same PHP code, we get a rather nasty result
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_05.php" data-overlay-height="600">	// Get variables
	$name = $_GET['name'];
	$pass = $_GET['pass'];
	$cont = (int) $_GET['cont']; ...</code></pre></div>
							</li>
							<li class="fragment">
								Problem: before submitting <code>$_GET</code> and <code>$_POST</code> are empty
								<ul>
									<li>
										The code stumbles upon the fact that we want to use a variable such as <code>$_GET['name'];</code> when it in fact is non-existent
									</li>
									<li>
										If we change all error texts with normal data it works fine
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Issue #1: Undefined Index (2)</h2>
						<ul>
							<li class="fragment">
								Fix: check with <code>isset()</code> if a variable exists before using it
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_06.php" data-overlay-height="600">&lt;?php

	$name = isset($_GET['name']) ? $_GET['name'] : '';
	...
?&gt;&lt;DOCTYPE html&gt;</code></pre></div>
							</li>
							<li class="fragment" style="margin-top: 1em">
								Caution: make sure the default value has the correct type
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_06.php" data-overlay-height="600">&lt;?php

	$meals = isset($_GET['meals']) ? $_GET['meals'] : array();
	...
?&gt;&lt;DOCTYPE html&gt;</code></pre></div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Issue #2: htmlentities/XSS (1)</h2>
						<ul>
							<li class="fragment">
								If we enter some HTML-looking text, we break the form
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_06.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	(same HTML code as before)
&lt;/form&gt;</code></pre></div>
								<ul>
									<li class="fragment">
										When entering <code>hello &quot; /&gt; test</code> we get this HTML
										<pre class="bigger"><code>&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;hello&quot; /&gt; test&quot; /&gt;</code></pre>
									</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Fix: convert special characters with <code>htmlentities()</code> to their HTML safe / encoded version <strong>when outputting on screen</strong>
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_07.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;get&quot;&gt;
	&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot;
	value=&quot;&lt;?php echo htmlentities($name); ?&gt;&quot; /&gt;
&lt;/form&gt;</code></pre></div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Issue #2: htmlentities/XSS (2)</h2>
						<ul>
							<li class="fragment">
								You must <strong>always</strong> use <code>htmlentities()</code> if you output/show user input in an HTML page
								<ul>
									<li class="fragment">If you don't, users can inject custom HTML into your site</li>
									<li class="fragment">Not a big security threat if it's <code>&lt;b&gt;&lt;/b&gt;</code></li>
									<li class="fragment">But what if we inject a custom javascript file via <code>&lt;script src=&quot;http://mysite.com/pwnd.js&quot;&gt;&lt;/script&gt;</code>?</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em">
								This kind of attack is known as <strong>cross-site scripting</strong> or <strong>XSS</strong>
								<ul>
									<li class="fragment">XSS is <a href="http://blogs.msdn.com/b/ie/archive/2012/09/10/xss-trends-and-internet-explorer.aspx">the most common vulnerability of websites</a>!</li>
									<li class="fragment">Example: <a href="http://blog.twitter.com/2010/09/all-about-onmouseover-incident.html">Twitter onMouseOver incident</a></li>
									<!-- li class="fragment">Example: <a href="http://praetorianprefect.com/archives/2010/06/persistent-xss-on-twitter-com/">Persistent XSS on Twitter</a></li -->
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em style="color: #F55;">!! If you don't prevent XSS in the assignments, you will fail them !!</em></footer>
					</section>

<!-- 					<section>
						<h2>Pitfall: Magic Quotes (1)</h2>
						<ul>
							<li class="fragment">
								In PHP pre 5.4, PHP would add backslashes before quotes in strings if the <em>magic_quotes</em> setting was enabled
								<ul>
									<li class="fragment">
										Problem: When persisting the backslashes double per submit
									</li>
									<li class="fragment">
										Fix: use <code>stripslashes()</code> but only if <em>magic_quotes</em> is enabled
									</li>
							</li>
						</ul>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_09.php" data-overlay-height="600">&lt;?php
// Strips automatically added slashes if magic_quotes is enabled
function stripPostSlashes($string) {
	return (get_magic_quotes_gpc() || get_magic_quotes_runtime())
		? stripslashes($string) : $string;
}
?&gt;&lt;!doctype html&gt;
...
&lt;dd class=&quot;text&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&lt;?php echo isset($_GET['name']) ? htmlentities(stripPostSlashes($_GET['name'])) : ''; ?&gt;&quot; class=&quot;input-text&quot; /&gt;&lt;/dd&gt;
...</code></pre></div>
						<footer class="fragment"><em>We won't be needing this as we're using PHP 5.4</em></footer>
					</section>

					<section>
						<h2>Pitfall: Magic Quotes (2)</h2>
						<ul>
							<li class="fragment">
								Let's improve our code, as running each var through <code>stripPostSlashes()</code> is quite cumbersome
							</li>
						</ul>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_10.php" data-overlay-height="600">&lt;?php
function stripPostSlashes($string) {
	return (get_magic_quotes_gpc() || get_magic_quotes_runtime())
		? stripslashes($string) : $string;
}

// Run each superglobal that can be affected by magic quotes through the stripPostSlashes before we get a chance of using them
$_POST = array_map('stripPostSlashes', $_POST);
$_GET = array_map('stripPostSlashes', $_GET);
$_REQUEST = array_map('stripPostSlashes', $_REQUEST);
$_COOKIE = array_map('stripPostSlashes', $_COOKIE);

?&gt;&lt;!doctype html&gt;
...
&lt;dd class=&quot;text&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&lt;?php echo isset($_GET['name']) ? htmlentities($_GET['name']) : ''; ?&gt;&quot; class=&quot;input-text&quot; /&gt;&lt;/dd&gt;
...</code></pre></div>
					</section> -->


					<section>
						<h2>Summary</h2>

						<ul>
							<li class="fragment">
								Put a block of code at the top where you fetch all vars and then later on work with those vars
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/persistency_11.php" data-overlay-height="600">&lt;?php

	$name = isset($_GET['name']) ? (string) $_GET['name'] : '';
	$pass = isset($_GET['pass']) ? (string) $_GET['pass'] : '';
	$gender = isset($_GET['gender']) ? (string) $_GET['gender'] : '';
	$cont = isset($_GET['cont']) ? (int) $_GET['cont'] : 0;
	$meals = isset($_GET['meals']) ? (array) $_GET['meals'] : array();
	$remark = isset($_GET['remark']) ? (string) $_GET['remark'] : '';

?&gt;&lt;!doctype html&gt;
...
&lt;dd class=&quot;text&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&lt;?php echo htmlentities($name); ?&gt;&quot; class=&quot;input-text&quot; /&gt;&lt;/dd&gt;
...</code></pre></div>
							</li>
							<li class="fragment">
							Always work with the raw variables in your scripts.<br />Only use <code>htmlentities()</code> when outputting it on screen
							</li>
						</ul>
					</section>

				</section>


				<!-- Formchecking -->
				<section>

					<section>
						<h2>Formchecking</h2>
					</section>

					<section>
						<h2>Formchecking</h2>
						<ul>
							<li class="fragment">= Check all values of a sent form for validity</li>
							<li class="fragment" style="margin-top: 1em;">
								If all checks out
								<ol>
									<li>Perform an action <em>(e.g. send an e-mail, insert a record into a database, etc.)</em></li>
									<li>Redirect to a thanks/OK page using <code>header('Location: ...');</code></li>
								</ol>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								If it doesn't check out
								<ol>
									<li>Build a list of error messages</li>
									<li>Continue with the script and show the form, including its error messages</li>
								</ol>
							</li>
						</ul>
					</section>

					<section>
						<h2>Why formchecking?</h2>
						<ul>
							<li class="fragment">
								Don't ever trust user input
								<ul>
									<li class="fragment">Data might be crafted in a way to harm your server (XSS!)</li>
									<li class="fragment">Data might be in the wrong format (e.g. dates)</li>
								</ul>
							</li>
							<li class="fragment">
								Even if a user means no harm, he might just have forgotten to complete a field
							</li>
							<li class="fragment">
								Therefore you <strong>must</strong> verify all incoming data
								<ul>
									<li>If any data is missing or malformed, inform the user with a proper message</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment" style="line-height:1;">Note that a user can easily edit the DOM (<code>POST</code>) or URL (<code>GET</code>)</footer>
					</section>


					<section>
						<h2>How to know if a form was sent? (1)</h2>
						<ul>
							<li class="fragment">
								Remember: Clicked buttons are also sent
								<div class="fragment"><pre class="bigger"><code class="language-php">&lt;?php

	// form was sent!
	if (isset($_POST['btnSubmit'])) {

		// @TODO: put formchecking logic here

	}

	...</code></pre></div>

							</li>
						</ul>
					</section>

					<section>
						<h2>How to know if a form was sent? (2)</h2>
						<ul>
							<li class="fragment">
								Pro-tip: Use a hidden field instead of trusting the button being clicked
								<div class="fragment"><pre class="bigger"><code class="language-php">&lt;?php

	$moduleAction = isset($_POST['moduleAction']) ? $_POST['moduleAction'] : '';

	// Form was sent!
	if ($moduleAction == 'processName') {
		// @TODO: put formchecking logic here
	}

?&gt;&lt;!DOCTYPE html&gt;

	...

	&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot;&gt;

		...

		&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processName&quot; /&gt;
		&lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;

		...

	&lt;/form&gt;</code></pre></div>

							</li>

							</li>
						</ul>
					</section>

					<section>
						<h2>How to know if a form was sent? (3)</h2>
						<ul>
							<li class="fragment" style="margin-top: 1em">
								Bonus: it affords to have one page process multiple forms
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/formchecking_multipleforms.php" data-overlay-height="600" style="height: 350px; overflow-y: scroll;">&lt;?php

	// initial values
	$moduleAction = isset($_POST['moduleAction']) ? $_POST['moduleAction'] : '';

	// form #1 was sent
	if ($moduleAction == 'processName') {
		// @TODO: put formchecking (form #1 only) logic here
	}

	// form #2 was sent
	if ($moduleAction == 'processAge')) {
		// @TODO: put formchecking (form #2 only) logic here
	}

	// ...

?&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
...
&lt;body&gt;

	&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot;&gt;

		...

		&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processName&quot; /&gt;
		&lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;

		...

	&lt;/form&gt;

	&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot;&gt;

		...

		&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processAge&quot; /&gt;
		&lt;input type=&quot;submit&quot; id=&quot;btnSubmit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;

		...

	&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Formchecking Example (Simplified)</h2>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/formchecking.php" data-overlay-height="600">&lt;?php

	// initial values
	$moduleAction = isset($_POST['moduleAction']) ? $_POST['moduleAction'] : '';
	$name = isset($_POST['name']) ? (string) $_POST['name'] : '';
	$msgName = '*';

	// form is sent
	if ($moduleAction == 'processName') {

		$allOk = true;

		// name not set, or empty
		if (trim($name) === '') {
			$msgName = 'Please enter your name';
			$allOk = false;
		}

		// end of form check.
		// If $allOk still is true, then the form was sent in correctly
		if ($allOk === true) {
			header('Location: formchecking_thanks.php?name=' .urlencode($name));
			exit();
		}

	}
	...</code></pre></div>
					</section>

					<section>
						<h2>Sidenote: urlencode</h2>
						<ul>
							<li class="fragment">
								When redirecting with a parameter in the URL, you must always <code>urlencode()</code> it manually
								<ul>
									<li>Again, never trust user submitted data</li>
									<li>The browser does this for you when submitting a form, but as we're doing it on the server now &hellip;
								</ul>
							</li>
							<li class="fragment">
								Not encoded
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/redirect_01.php" data-overlay-height="600">$gun = 'smith&amp;wesson';
header('Location: redirect_process.php?gun=' . $gun);
exit(0); // do not forget to exit after redirect</code></pre></div>
							</li>
							<li class="fragment">
								Encoded
								<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/redirect_02.php" data-overlay-height="600">$gun = 'smith&amp;wesson';
header('Location: redirect_process.php?gun=' . urlencode($gun));
exit(0); // do not forget to exit after redirect</code></pre></div>
							</li>
						</ul>
					</section>
				</section>



				<!-- File Uploads -->
				<section>

					<section>
						<h2>File Uploads</h2>
					</section>

					<section>
						<h2>File Uploads</h2>
						<ul>
							<li class="fragment">Preparation
								<ul>
									<li class="fragment">Add the <code>enctype=&quot;multipart/form-data&quot;</code> attribute to the form </li>
									<li class="fragment">Set the form <code>method</code> to <code>post</code></li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Handling file uploads
								<ul>
									<li>PHP will fill the <code>$_FILES</code> superglobal with info about each file sent</li>
									<li class="fragment">File uploads are stored in a temp folder on the server, you'll have to move them manually <br />&rarr; <em>see next workshop</em></li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Demo</h2>
						<div class="fragment"><pre class="bigger"><code class="language-php" data-overlay-example="assets/03/examples/files_01.php" data-overlay-height="600">&lt;form action=&quot;&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;

	&lt;fieldset&gt;

		&lt;h2&gt;Testform&lt;/h2&gt;

		&lt;dl class=&quot;clearfix&quot;&gt;

			&lt;dt&gt;&lt;label for=&quot;image&quot;&gt;Image&lt;/label&gt;&lt;/dt&gt;
			&lt;dd&gt;&lt;input type=&quot;file&quot; id=&quot;image&quot; name=&quot;image&quot; value=&quot;&quot; /&gt;&lt;/dd&gt;

			&lt;dt&gt;
				&lt;input type=&quot;hidden&quot; name=&quot;moduleAction&quot; value=&quot;processUpload&quot; /&gt;
				&lt;input type=&quot;submit&quot; name=&quot;btnSubmit&quot; value=&quot;Send&quot; /&gt;
			&lt;/dt&gt;

		&lt;/dl&gt;

	&lt;/fieldset&gt;

&lt;/form&gt;</code></pre></div>
						<footer class="fragment">Note: it is not possible to persist files in the strict sense.</footer>
					</section>

					<section>
						<h2>Under the hood</h2>
						<ul>
							<li class="fragment">
								The browser will send the file as an entity
								<ul>
									<li>Entities are sent in the <strong>request body</strong></li>
									<li>Entities are separated by a <strong>boundary</strong>, randomly generated by the browser</li>
									<li>Each entity has its own headers identifying the entity</li>
								</ul>
							</li>
						</ul>
						<div class="fragment">
							<figure class="zoomable-20">
								<img src="assets/03/files.jpg" alt="Charles output of a file sent via POST" title="Charles output of a file sent via POST" width="350" />
								<figcaption>Charles output of a file sent via POST</figcaption>
							</figure>
						</div>
						<footer class="fragment"><em>Note: the boundary and entity headers are part of the multipart/form-data [RFC 2388] standard</em></footer>
					</section>

				</section>




				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Summary -->
				<section id="summary">

					<section>
						<h2>Code summary</h2>

						<p style="margin-top: 5.5em;"><em>A code-only summary of this chapter is available at <a href="03.forms.summary.html">03.forms.summary.html</a></em></p>
						<footer>
							<em>Note: not all information from these slides can be found in this summary!</em>
						</footer>

					</section>

				</section>



				<!-- Sources -->
				<!-- section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>
							<li>...</li>
						</ul>
					</section>
				</section -->

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>